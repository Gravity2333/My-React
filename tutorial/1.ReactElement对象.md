# ReactElement对象
或许你听说过，React在程序编写者（作者）和 真实Dom之间加入了一层虚拟DOM层，而ReactElement对象，就是作者编写的入口，其具体实现可以在[lib/react/index.ts](../lib/react/index.ts)中查看。

其中 reactElement的ts定义如下:
```typescript
export type ReactElementType = any;
/** 属性类型 */
export type ReactElementProps = Record<string, any>;
/** key */
export type Key = string;

/** Element元素类型 */
export interface ReactElement {
  $$typeof: Symbol | number;
  key: Key;
  ref?: Ref;
  type: ReactElementType;
  props: ReactElementProps;
}
```
### ReactElement中关键属性解析

#### 1. `$$typeof`
`$$typeof` 用来区分一个对象到底是普通对象还是一个 ReactElement 对象。React 通过这个属性来检查当前的对象是不是符合规定的 ReactElement 对象。如果不是，它会抛出异常。

**注意**：如果我们在 JSX 中直接渲染一个 `{}`，会报错：

Error: "Object is not a React Element"


#### 2. `key`
`key` 是每个 ReactElement 对应的唯一标识符。它不能重复，并且最好和这个元素本身的信息绑定。`key` 可以是数据的 `key`，也可以是一些关键信息的组合（例如：`concat`）。

**最佳实践**：`key` 应该与数据关联，这样可以最大程度地保证渲染性能的优化。

- 如果 `key` 重复，React reconciler 在标记删除的时候，就不会删除这个重复 `key` 的 fiber 节点，这样会导致页面渲染时出现重复节点。

**总结**：`key` 不能重复，至少在一个元素的子元素层级下是不可重复的。

#### 3. `ref`
`ref` 的本意是获得当前 element 节点所对应的数据。

- 对于 `div`、`span` 等浏览器原生提供的 HostComponent 和 HostText，`ref` 一般会返回/绑定其真实 DOM 元素。
- 对于 `ClassComponent`，`ref` 一般会返回其实例对象。
- 对于 `FunctionComponent`，没有对应的数据，因此默认情况下没有 `ref`。如果需要使用 `ref`，可以通过 `forwardRef` 来转发 `ref`，并且自己确定 `ref` 所绑定的数据（例如使用 `useImperativeHandle`）。

#### 4. `type`
`type` 用来记录当前ReactElement的类型，一般为string ｜ Function ｜ Class 

- 对于 `div`、`span` 等浏览器原生提供的 HostComponent 和 HostText，`type` 为字符串类型。
- 对于 `ClassComponent`，`FunctionComponent` ，`type` 为对应的类或者函数

#### 4. `props`
`props` 是一个对象，用来记录当前Element对应的属性，其中也包含children,ref,key 等等 

### 小结
- `$$typeof` 用于判断对象是否为 ReactElement。
- `key` 是 React 元素的唯一标识符，不能重复。
- `ref` 用于获取对应的 DOM 或组件实例，`FunctionComponent` 需要使用 `forwardRef` 来转发 `ref`。

### 如何创建ReactElement对象
React提供了CreateReactElement方法用来创建一个ReactElement对象，其实现也比较简单，其中入参为 类型 type 属性Props（ref key 都是在props中传入）子元素children数组

```typescript
export function createElement(
  type: ReactElementType,
  props: ReactElementProps,
  ...children: ReactElementChildren[]
): ReactElement {
  return {
    $$typeof: REACT_ELEMENT_TYPE,
    type,
    ref: props.ref ? props.ref : null,
    key: props.key ? String(props.key) : null,
    props: {
      ...props,
      children:
        children?.length === 1
          ? children[0]
          : children,
    },
  };
}
```
实现就是包装一个ReactElement对象，并且将Props中的ref key children单独处理
- Ref拿出来，单独做一个属性，
- 入参type单独作为一个属性
- key单独作为一个属性
- 对于children，如果只有一个children就保存为props中的一个element对象，如果有多个children就作为一个element数组

### JSX & 语法糖
我们在编写组件的时候一般使用JSX的方式编写，由babel将我们编写的jsx转化成createElement对象，（对于新版本react其实转换成jsx()函数，但是本质上都一样！）
在本项目中，我们现以createELement的方式编写组件，babel转换考虑在后面加入！